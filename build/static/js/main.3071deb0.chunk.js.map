{"version":3,"sources":["../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","yolkjs/index.js","index.js"],"names":["_slicedToArray","arr","i","Array","isArray","Symbol","iterator","Object","prototype","toString","call","_arr","_n","_d","_e","undefined","_s","_i","next","done","push","value","length","err","TypeError","_defineProperty","obj","key","defineProperty","enumerable","configurable","writable","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","apply","_objectSpread2","target","arguments","source","forEach","getOwnPropertyDescriptors","defineProperties","updateDom","dom","preProps","nextProps","name","slice","removeEventListener","toLowerCase","addEventListener","updateQueue","performWork","deadline","nextUnitOfWork","shift","performUnitOfWork","wipRoot","deletions","commitWorker","child","currentRoot","workLoop","requestIdleCallback","fiber","domParentFiber","parent","domParent","effectTag","appendChild","commitDeletion","removeChild","base","props","sibling","isFunctionComponent","type","Function","console","log","hookIndex","wipFiber","hooks","children","reconcileChildren","updateFunctionComponent","vdom","document","createTextNode","createElement","createDom","elements","updateHostComponent","nextFiber","index","oldFiber","preSibling","element","newFiber","sameType","warn","__source","map","nodeValue","render","container","useState","init","hook","oldHook","state","queue","action","scheduleWork","ReactDOM","React","count","setCount","demo","setDemo","id","title","href","onClick","c1","Math","random","Promise","resolve","then","c2","setTimeout","c3","addTwice","getElementById"],"mappings":"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","file":"static/js/main.3071deb0.chunk.js","sourcesContent":["import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || nonIterableRest();\n}","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (!(Symbol.iterator in Object(arr) || Object.prototype.toString.call(arr) === \"[object Arguments]\")) {\n    return;\n  }\n\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance\");\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","\r\n/**\r\n * 创建虚拟dom的方法\r\n * @param {string} type 元素类型\r\n * @param {any} props jsx传递的属性\r\n * @param  {...any} children 子元素 \r\n */\r\nfunction createElement(type, props, ...children) {\r\n  console.warn(children);\r\n  if (props) {\r\n    delete props.__source;\r\n  }\r\n  return {\r\n    type,\r\n    props: {\r\n      ...props,\r\n      children: children.map(child =>\r\n        typeof child === 'object' ? child : createTextElement(child)\r\n      )\r\n    }\r\n  }\r\n}\r\n\r\nfunction createTextElement(text) {\r\n  return {\r\n    type: 'TEXT',\r\n    props: {\r\n      nodeValue: text,\r\n      children: [],\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * 通过虚拟 dom 新建 dom 元素\r\n * @param {*} vdom 虚拟 dom\r\n */\r\nfunction createDom(vdom) {\r\n  const dom = vdom.type === \"TEXT\"\r\n    ? document.createTextNode(\"\")\r\n    : document.createElement(vdom.type)\r\n  updateDom(dom, {}, vdom.props)\r\n  // Object.keys(vdom.props).forEach(name => {\r\n  //   if (name !== \"children\") {\r\n  //     // @todo: 属性判断，事件处理\r\n  //     dom[name] = vdom.props[name]\r\n  //   }\r\n  // })\r\n  return dom\r\n}\r\n\r\nfunction updateDom(dom, preProps, nextProps) {\r\n  // debugger\r\n  /**\r\n   * 1. 规避 children 属性\r\n   * 2. 老得存在，取消\r\n   * 3. 新的存在，新增， \r\n   */\r\n\r\n  //  @todo 兼容性问题  \r\n\r\n  const filterPreProps = name => {\r\n    if (name.slice(0, 2) !== 'on') {\r\n      return false\r\n    }\r\n    if (!(name in nextProps)) {\r\n      return false\r\n    }\r\n    return true\r\n  }\r\n  \r\n  Object.keys(preProps)\r\n    .filter(name => name !== 'children')\r\n    .filter(filterPreProps)\r\n    .forEach(name => {\r\n      if (name.slice(0, 2) === 'on') {\r\n        // debugger\r\n        // onclick => chick\r\n        dom.removeEventListener(name.slice(2).toLowerCase(), preProps[name], false)\r\n      } else {\r\n        dom[name] = ''\r\n      }\r\n    })\r\n\r\n  Object.keys(nextProps)\r\n    .filter(name => name !== 'children')\r\n    .forEach(name => {\r\n      if (name.slice(0, 2) === 'on') {\r\n        // debugger\r\n        // onclick => chick\r\n        dom.addEventListener(name.slice(2).toLowerCase(), nextProps[name], false)\r\n      } else {\r\n        dom[name] = nextProps[name]\r\n      }\r\n    })\r\n}\r\n\r\nconst updateQueue = []\r\n\r\nfunction render(vdom, container) {\r\n  // debugger\r\n  wipRoot = {\r\n    dom: container,\r\n    props: {\r\n      children: [vdom],\r\n    },\r\n    base: currentRoot, // 分身\r\n  }\r\n  updateQueue.push(wipRoot)\r\n  deletions = []\r\n  // nextUnitOfWork = wipRoot\r\n  // container.innerHTML = `<pre>${JSON.stringify(vdom, null, 2)}</pre>`\r\n  // 递归渲染的子元素\r\n  // vdom.props.children.forEach(child => render(child, dom))\r\n\r\n  // container.appendChild(dom)\r\n  requestIdleCallback(performWork)\r\n}\r\n\r\nfunction scheduleWork(wipRoot) {\r\n  updateQueue.push(wipRoot)\r\n  deletions = []\r\n  requestIdleCallback(performWork) //开始干活\r\n}\r\n\r\n// function performWork() {\r\n//   //  启动空闲时间渲染\r\n//   requestIdleCallback(workLoop)\r\n// }\r\n\r\nfunction performWork(deadline) {\r\n  workLoop(deadline)\r\n  if (nextUnitOfWork || updateQueue.length > 0) {\r\n    requestIdleCallback(performWork) //继续干\r\n  }\r\n}\r\n\r\nfunction createWorkInProgress(queue) {\r\n  return queue.shift()\r\n}\r\n\r\nfunction commitRoot() {\r\n  deletions.forEach(commitWorker)\r\n  commitWorker(wipRoot.child)\r\n  currentRoot = wipRoot\r\n  wipRoot = null\r\n  nextUnitOfWork = null\r\n}\r\n\r\nfunction commitWorker(fiber) {\r\n  if (!fiber) {\r\n    return\r\n  }\r\n  // const domParent = fiber.parent.dom\r\n  // domParent.appendChild(fiber.dom)\r\n  let domParentFiber = fiber.parent\r\n  while (!domParentFiber.dom) {\r\n    domParentFiber = domParentFiber.parent\r\n  }\r\n  const domParent = domParentFiber.dom\r\n  if (fiber.effectTag === 'PLACEMENT' && fiber.dom !== null) {\r\n    domParent.appendChild(fiber.dom)\r\n  } else if (fiber.effectTag === 'DELETION') {\r\n    commitDeletion(fiber, domParent)\r\n    // domParent.removeChild(fiber.dom)\r\n  } else if (fiber.effectTag === 'UPDATE' && fiber.dom !== null) {\r\n    // 更新dom\r\n    updateDom(fiber.dom, fiber.base.props, fiber.props)\r\n  }\r\n  commitWorker(fiber.child)\r\n  commitWorker(fiber.sibling)\r\n}\r\n\r\nfunction commitDeletion(fiber, domParent) {\r\n  if (fiber.dom) {\r\n    domParent.removeChild(fiber.dom)\r\n  } else {\r\n    commitDeletion(fiber.child, domParent)\r\n  }\r\n}\r\n\r\n// 下一个单元任务\r\n// render 函数会初始化第一个任务\r\nlet nextUnitOfWork = null\r\nlet wipRoot = null\r\nlet currentRoot = null\r\nlet deletions = null\r\n\r\n//  调度我们的 diff 或者渲染任务\r\nfunction workLoop(deadline) {\r\n  if (!nextUnitOfWork) {\r\n    //一个周期内只创建一次\r\n    nextUnitOfWork = createWorkInProgress(updateQueue)\r\n  }\r\n  // 有下一个任务，且当前帧还没有结束\r\n  // while (nextUnitOfWork && deadline.timeRemaining() > 1) {\r\n  while (nextUnitOfWork) { // 方便调试 去掉判断当前帧是否没有结束\r\n    // \r\n    nextUnitOfWork = performUnitOfWork(nextUnitOfWork)\r\n  }\r\n  if (!nextUnitOfWork && wipRoot && !updateQueue.length) {\r\n    // 没有任务了，并且根节点还在\r\n    commitRoot()\r\n  }\r\n  // requestIdleCallback(workLoop)\r\n}\r\n\r\nfunction performUnitOfWork(fiber) {\r\n  const isFunctionComponent = fiber.type instanceof Function\r\n  console.log('iisFunctionComponents', isFunctionComponent, fiber.type, fiber)\r\n  if (isFunctionComponent) {\r\n    updateFunctionComponent(fiber)\r\n  } else {\r\n    // dom\r\n    updateHostComponent(fiber)\r\n  }\r\n  // 找下一个任务\r\n  // 先找子元素\r\n  if (fiber.child) {\r\n    return fiber.child\r\n  }\r\n  let nextFiber = fiber\r\n  // 没有子元素，就找兄弟元素\r\n  while (nextFiber) {\r\n    if (nextFiber.sibling) {\r\n      return nextFiber.sibling\r\n    }\r\n    // 没有兄弟元素，找父元素\r\n    nextFiber = nextFiber.parent\r\n  }\r\n}\r\n\r\nlet wipFiber = null\r\nlet hookIndex = null\r\nfunction useState(init) {\r\n  // debugger\r\n  const oldHook = wipFiber.base && wipFiber.base.hooks[hookIndex]\r\n  let hook\r\n  if (oldHook) {\r\n    hook = oldHook\r\n  } else {\r\n    hook = {\r\n      state: oldHook ? oldHook.state : init,\r\n      queue: []\r\n    }\r\n  }\r\n  const actions = oldHook ? oldHook.queue : []\r\n  actions.forEach(action => {\r\n    hook.state = action\r\n  })\r\n  hook.queue.shift()\r\n  const setState = action => {\r\n    // debugger\r\n    // hook.queue.length = 0\r\n    hook.queue.push(action)\r\n    wipRoot = {\r\n      dom: currentRoot.dom,\r\n      props: currentRoot.props,\r\n      base: currentRoot,\r\n    }\r\n    // nextUnitOfWork = wipRoot\r\n    deletions = []\r\n    scheduleWork(wipRoot)\r\n  }\r\n  wipFiber.hooks.push(hook)\r\n  hookIndex++\r\n  return [hook.state, setState]\r\n}\r\n\r\nfunction updateFunctionComponent(fiber) {\r\n  wipFiber = fiber\r\n  hookIndex = 0\r\n  wipFiber.hooks = []\r\n  const children = [fiber.type(fiber.props)]\r\n  reconcileChildren(fiber, children)\r\n}\r\n\r\nfunction updateHostComponent(fiber) {\r\n  // 获取下一个任务\r\n  // 根据当前任务获取下一个任务\r\n  if (!fiber.dom) {\r\n    // 不是入口\r\n    fiber.dom = createDom(fiber)\r\n  }\r\n\r\n  // // 真实的 dom 操作\r\n  // if (fiber.parent) {\r\n  //   fiber.parent.dom.appendChild(fiber.dom)\r\n  // }\r\n\r\n  const elements = fiber.props.children\r\n\r\n  reconcileChildren(fiber, elements)\r\n\r\n}\r\n\r\nfunction reconcileChildren(wipFiber, elements) {\r\n  // 构建成 fiber\r\n  let index = 0\r\n  let oldFiber = wipFiber.base && wipFiber.base.child\r\n  let preSibling = null\r\n  while (index < elements.length) {\r\n    // while (index < elements.length) {\r\n    let element = elements[index]\r\n    let newFiber = null\r\n    // 对比 oldfiber 的状态和当前 element\r\n    // 先比较类型，\r\n    const sameType = oldFiber && element && oldFiber.type === element.type\r\n    if (sameType) {\r\n      // 复用节点，更新\r\n      newFiber = {\r\n        type: oldFiber.type,\r\n        props: element.props,\r\n        dom: oldFiber.dom,\r\n        parent: wipFiber,\r\n        base: oldFiber,\r\n        effectTag: \"UPDATE\",\r\n      }\r\n    }\r\n\r\n    if (!sameType && element) {\r\n      // 新增节点\r\n      newFiber = {\r\n        type: element.type,\r\n        props: element.props,\r\n        dom: null,\r\n        parent: wipFiber,\r\n        base: null,\r\n        effectTag: \"PLACEMENT\",\r\n      }\r\n    }\r\n    if (!sameType && oldFiber) {\r\n      // 删除\r\n      oldFiber.effectTag = \"DELETION\"\r\n      deletions.push(oldFiber)\r\n    }\r\n\r\n    if (oldFiber) {\r\n      oldFiber = oldFiber.sibling\r\n    }\r\n    if (index === 0) {\r\n      // 第一个元素，是父 fiber 的 child 属性\r\n      wipFiber.child = newFiber\r\n    } else {\r\n      // 其他元素是兄弟元素\r\n      preSibling.sibling = newFiber\r\n    }\r\n    preSibling = newFiber\r\n    index++\r\n    // fiber 基本结构构建完毕\r\n  }\r\n}\r\n\r\n\r\nexport default {\r\n  createElement,\r\n  render,\r\n  useState,\r\n}","// import React from 'react'\r\n// import ReactDOM from 'react-dom'\r\n\r\nimport React from './yolkjs'\r\n\r\nconst ReactDOM = React\r\n\r\nfunction App(props) {\r\n  const [count, setCount] = React.useState(1)\r\n  const [demo, setDemo] = React.useState('hello')\r\n  const addTwice = () => {\r\n    const c1 = Math.random() * 10 + count\r\n    console.warn(\"[c1]\", c1)\r\n    setCount(c1)\r\n    Promise.resolve().then(() => {\r\n      const c2 = Math.random() * 10 + count\r\n      console.warn(\"[c2]\", c2)\r\n      // debugger\r\n      setCount(c2)\r\n      setTimeout(() => {\r\n        const c3 = Math.random() * 10 + count\r\n        console.warn(\"[c3]\", c3)\r\n        debugger\r\n        setCount(c3)\r\n      }, 5000)\r\n    })\r\n  }\r\n  return (\r\n    <div id=\"app\">\r\n      <h1>hello, {props.title}</h1>\r\n      <p>react dom {count}</p>\r\n      <p>react demo {demo}</p>\r\n      <a href=\"https://jd.com\">shop</a>\r\n      <button onClick={() => addTwice()}>add</button>\r\n      <button onClick={ () => setDemo(demo + Math.random() * 10) }>change</button>\r\n    </div>\r\n  )\r\n}\r\n\r\nlet element = <App title=\"yolkjs\" />\r\n\r\nReactDOM.render(element, document.getElementById('root'))\r\n"],"sourceRoot":""}